<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MAD Token</title>
    
        <link rel="icon" href="./assets/logo.png">
    
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    
        <!-- Slick CSS -->
        <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    
        <!-- Font -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
        <!-- Custom CSS -->
        <link rel="stylesheet" href="./style.css">
    </head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-transparent">
    <div class="container">
        <a class="navbar-brand" href="#">
            <img src="./assets/logo.png" alt="MAD Token logo">
        </a>
        <button class="navbar-toggler" type="button">
            <div class="btn btn-primary btn-connect">
                Connect Wallet
            </div>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">
                <div class="btn btn-primary btn-connect">
                    Connect Wallet
                </div>
              </a>
            </li>
          </ul>
        </div>
    </div>
</nav>
<!-- Navbar END -->

<section class="details">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6">
                <h1>Charity Details</h1>
                <img src="./assets/logo-campaign-1.png" alt="logo campaign">
                <h2>Alex’s Lemonade Stand’s</h2>
            </div>
            <div class="col-12 col-md-6 d-flex align-items-center my-4 my-md-0">
                <img class="w-100" src="/assets/hero-banner.svg" alt="banner">
            </div>
            <div class="col-12 col-lg-6">
                Fighting childhood cancer, one cup at a time
                Alex’s Lemonade Stand’s mission is to change the lives of children with cancer through funding impactful research, raising awareness, supporting families, and empowering everyone to help cure childhood cancer
                <div class="btn btn-address-charity">
                    <span class="title">Address</span>
                    <input class="address" id="charity-address" value="0x9Bb467Ba28ec9B1018696D6d5F89AB32fafC9A4D" onchange="this.value = this.value.replace(/,/g, '.')" readonly>
                    <span class="copy btn-copy-address-charity" data-clipboard-target="#charity-address">
                        <i class="far fa-copy"></i>
                    </span>
                    <span class="link">
                        <a target="_blank" href="https://bscscan.com/address/0x9Bb467Ba28ec9B1018696D6d5F89AB32fafC9A4D">
                            <i class="far fa-external-link"></i>
                        </a>
                    </span>
                </div>

                <p class="mt-3">
                    ID: <span id="charity_id">ID123456</span>
                </p>

                <p class="agreement">
                    By making your donation you acknowledge that you have read and accept our <a target="_blank" href="https://madtoken.org/">Terms of Use.</a>
                </p>
            </div>

            <div class="col-12 col-lg-5 offset-lg-1">
                <div class="payment">
                    <h3>Select Payment</h3>
                    <div class="payment-method" data-type="bnb">
                        <div class="d-flex align-items-center">
                            <img src="/assets/ic-bnb.svg" alt="icon">
                            <p>BNB</p>
                        </div>
                        <img src="/assets/ic-chevron-right.svg" alt="icon">
                    </div>
                    <div class="payment-method" data-type="busd">
                        <div class="d-flex align-items-center">
                            <img src="https://pancakeswap.finance/images/tokens/0xe9e7cea3dedca5984780bafc599bd69add087d56.png" width="40" height="40" alt="icon">
                            <p>BUSD</p>
                        </div>
                        <img src="/assets/ic-chevron-right.svg" alt="icon">
                    </div>
                    <div class="payment-method" data-type="eth">
                        <div class="d-flex align-items-center">
                            <img src="https://pancakeswap.finance/images/tokens/0x2170ed0880ac9a755fd29b2688956bd959f933f8.png" width="40" height="40" alt="icon">
                            <p>ETH</p>
                        </div>
                        <img src="/assets/ic-chevron-right.svg" alt="icon">
                    </div>
                    <div class="payment-method" data-type="btcb">
                        <div class="d-flex align-items-center">
                            <img src="https://pancakeswap.finance/images/tokens/0x7130d2a12b9bcbfae4f2634d864a1ee1ce3ead9c.png" width="40" height="40" alt="icon">
                            <p>BTCB</p>
                        </div>
                        <img src="/assets/ic-chevron-right.svg" alt="icon">
                    </div>
                    <div class="payment-method" data-type="mad">
                        <div class="d-flex align-items-center">
                            <img width="12%" height="12%" src="/assets/mad-ticker.png" alt="icon">
                            <p>MAD</p>
                        </div>
                        <img src="/assets/ic-chevron-right.svg" alt="icon">
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal -->
<div class="modal modal-payment fade" id="modalPaymentBNB" tabindex="-1" aria-labelledby="modalPaymentBNBLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="modalPaymentBNBLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
            <div id="container-balance">
                <h6 class="balance balance-bnb">Your Balance : <span id="amount-balance-bnb" class="your-balance-bnb"></span> BNB</h6>
                <h6 class="balance balance-token">Your Balance : <span id="amount-balance-token" class="your-balance-token"></span> <span class="your-symbol-token text-dark"></span></h6>
            </div>
            <div class="row">
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <input type="text" name="name" id="donor_name" class="form-control" placeholder="Name" required>
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <div class="form-group">
                        <input type="text" name="email" id="donor_email" class="form-control" placeholder="Email" required>
                    </div>
                </div>
            </div>
            <div class="box-amount">
                <div class="d-flex align-items-center justify-content-between flex-wrap w-100">
                    <div>
                        <h6>Amount</h6>
                        <input class="amount" value="0" type="text" id="amountRange"/>
                    </div>
                    <div class="max-amount-wrapper">
                        <div class="btn btn-max-amount">Max Amount</div>
                        <h6 id="usd-price-conversion" class="usd-price-conversion">$0</h6>
                    </div>
                </div>
<!--                <form>-->
                    <div class="amount-count">
                        <div class="btn btn-outline-primary btn-minus-amount mr-2 mr-lg-4">
                            <i class="far fa-minus"></i>
                        </div>
                        <div id='meter'>
                            <div id='progress'></div>
                        </div>
                        <div class="btn btn-outline-primary btn-plus-amount ml-2 ml-lg-4">
                            <i class="far fa-plus"></i>
                        </div>
                        <p><span id="percentage-amount" class="ml-2">25</span>%</p>
                    </div>
<!--                </form>-->
                <div class="row">
                    <div class="col-12 col-md-6 mb-4">
                        <p>BUSD_MAD price :</p>
                        <span class="btn-white BUSD_MAD"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-4">
                        <p>MAD_BUSD price :</p>
                        <span class="btn-white MAD_BUSD"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-4">
                        <p>BNB_MAD price :</p>
                        <span class="btn-white BNB_MAD"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-4">
                        <p>MAD_BNB price :</p>
                        <span class="btn-white MAD_BNB"></span>
                    </div>
                </div>
                <p class="notes-token">
                    Every token will be swap into MAD then donated
                </p>
            </div>
            <button class="btn btn-primary btn-donate-modal btn-block">Donate Now</button>
            <button id="button-click-approve" class="btn btn-primary btn-block btn-approve-modal">Approve</button>
            <div class="accordion accordion-history" id="accordionExample">
                <div id="headingOne">
                    <h2 class="mb-0">
                        <button class="btn btn-link-primary" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          History of your transaction
                          <i class="fas fa-chevron-down"></i>
                        </button>
                      </h2>
                  </div>

                  <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                    <ul id="donate-history">

                    </ul>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
 <!-- Campaign END -->

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row footer-row">
                <div class="col-12 col-md-3">
                    <img src="./assets/logo.png" alt="MAD Token logo">
                    <p>The World's Most Transparent Charity Token</p>
                </div>
                <div class="col-12 col-md-6" style="display: flex; align-items: center; justify-content: space-between;">
                    <p class="copyright">&copy; All right reserved by MAD Token</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer END -->


    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

    <!-- Slick JS -->
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <!-- Main JS -->
    <script src="./main.js"></script>
<script>
    $(function(){
        Wallet.checkAllowance();
        let value, result,percentage,amountRange, progress, type, typeTemp;
        value = 0;
        percentage = document.getElementById('percentage-amount');
        amountRange = document.getElementById("amountRange");
        progress = document.getElementById("progress");

        let charity_id = document.getElementById('charity_id').innerText;

        $('.btn-donate-modal').click(() => {
            let amount = document.getElementById('amountRange').value;
            let address = document.getElementById('charity-address').value;
            let donor_name = document.getElementById('donor_name').value;
            let donor_name_field = document.getElementById('donor_name');
            let donor_email = document.getElementById('donor_email').value;
            let donor_email_field = document.getElementById('donor_email');

            function validateEmail(email) {
                const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            }

            if (donor_name.length > 0 && validateEmail(donor_email)) {
                Wallet.swap(address,amount.toString(),type,donor_name,donor_email,charity_id);
            } else {
                alert('please fill name and email address correctly.');

                if (donor_name.length < 1) {
                    donor_name_field.classList.add('has-error');
                } else {
                    donor_name_field.classList.remove('has-error');
                }

                if (!validateEmail(donor_email)) {
                    donor_email_field.classList.add('has-error');
                } else {
                    donor_email_field.classList.remove('has-error');
                }
            }
        });

        $('#button-click-approve').click(() => {
            Wallet.reqApprove(type);
        });

        $('.payment-method').click(function () {
            type = $(this).attr('data-type');
            Wallet.checkAllowance(type);
            let donor_address = $('.your-address')[0].innerText;
            Wallet.getHistory(donor_address,type,charity_id);
            Wallet.getBalance(donor_address,type);
            value = 0;
            progress.style.width = value + "%";
            percentage.innerText = value;
            amountRange.value = value;
            document.getElementById('usd-price-conversion').innerText = '0';

            if (type !== 'mad'){
                $('.balance-bnb').show();
                $('.balance-token').hide();
                // $('.notes-token').show();
            }
            if (type !== 'bnb' && type !== 'mad') {
                $('.balance-token').show();
                $('.balance-bnb').hide();
                // $('.notes-token').show();
            }
            $('#modalPaymentBNB').modal('show');
        });

        const calcPrice = async () => {
            let convert;
            if (type === 'mad'){
                let convert_curr = await Wallet.getPriceMAD();
                convert = convert_curr.MAD_BUSD;
            }else {
                convert = await Wallet.getPriceBNB(type,true);
            }
            console.log(`price ${type} : $${convert}`);
            let totalConvert = (convert * amountRange.value).toFixed(3);
            document.getElementById('usd-price-conversion').innerText = `$ ${totalConvert}`;
        }

        $('#amountRange').keyup(async () => {
            await calcPrice();
        });

        $('.btn-plus-amount').click(function() {
            if (type !== 'bnb'){
                typeTemp = 'token'
            }else {
                typeTemp = 'bnb'
            }
            increase(typeTemp);
            calcPrice();
        })

        $('.btn-minus-amount').click(function() {
            if (type !== 'bnb'){
                typeTemp = 'token'
            }else {
                typeTemp = 'bnb'
            }
            decrease(typeTemp);
            calcPrice();
        })

        $('.btn-max-amount').click(function() {
            if (type !== 'bnb'){
                typeTemp = 'token'
            }else {
                typeTemp = 'bnb'
            }
            maxAmount(typeTemp);
            calcPrice();
        })

        function increase(type) {
            let amount = document.getElementById(`amount-balance-${type}`);
            value = value + 25;
            if(value>=100) value = 100;
            percentage.innerText = value;
            result = amount.textContent * (value / 100);
            amountRange.value = result;
            progress.style.width = value + "%";
        }

        function decrease(type) {
            let amount = document.getElementById(`amount-balance-${type}`);
            value = value - 25;
            if(value<=0) value = 0;
            percentage.innerText = value;
            result = amount.textContent * (value / 100);
            amountRange.value = result;
            progress.style.width = value + "%";
        }

        function maxAmount(type) {
            let amount = document.getElementById(`amount-balance-${type}`);
            value = 100;
            if(value>=100) value = 100;
            percentage.innerText = value;
            result = amount.textContent * (value / 100);
            amountRange.value = result;
            progress.style.width = value + "%";
        }
    });
</script>
</body>
</html>
